# ğŸ”„ Complete Code Flow: Frontend â†’ Database

## ğŸ“‹ **Step-by-Step Flow Diagram**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           FRONTEND INPUT                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. User Types in Input Field                                                â”‚
â”‚                                                                             â”‚
â”‚    <input type="text" id="code" value={code} onChange={(e) => setCode(e.target.value)} />
â”‚                                                                             â”‚
â”‚    User types: "ABC123" â†’ code state = "ABC123"                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Form Submission (ImportForm.tsx)                                         â”‚
â”‚                                                                             â”‚
â”‚    handleSubmit() function:                                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ // Prepare input object                                             â”‚ â”‚
â”‚    â”‚ let input = {}                                                      â”‚ â”‚
â”‚    â”‚ if (!useCustomInput) {                                              â”‚ â”‚
â”‚    â”‚   input = { code, codeType }  // code = "ABC123"                   â”‚ â”‚
â”‚    â”‚ }                                                                   â”‚ â”‚
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ // Send to API                                                      â”‚ â”‚
â”‚    â”‚ fetch('/api/import', {                                              â”‚ â”‚
â”‚    â”‚   method: 'POST',                                                   â”‚ â”‚
â”‚    â”‚   body: JSON.stringify({                                            â”‚ â”‚
â”‚    â”‚     actorId: 'HceSv1pj0Y3PZTMvG',                                  â”‚ â”‚
â”‚    â”‚     input: { code: "ABC123", codeType: "HR_COCKPIT" }              â”‚ â”‚
â”‚    â”‚   })                                                               â”‚ â”‚
â”‚    â”‚ })                                                                  â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. API Route Handler (app/api/import/route.ts)                             â”‚
â”‚                                                                             â”‚
â”‚    POST /api/import                                                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ // 1. Parse request body                                            â”‚ â”‚
â”‚    â”‚ const { actorId, input } = await request.json()                     â”‚ â”‚
â”‚    â”‚ // input = { code: "ABC123", codeType: "HR_COCKPIT" }              â”‚ â”‚
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ // 2. Start Apify run                                               â”‚ â”‚
â”‚    â”‚ run = await client.actor(actorId).call(input)                      â”‚ â”‚
â”‚    â”‚ // run.id = "abc123def456"                                         â”‚ â”‚
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ // 3. Extract code values                                          â”‚ â”‚
â”‚    â”‚ const code = input?.code || null        // "ABC123"                â”‚ â”‚
â”‚    â”‚ const code_type = input?.codeType || null // "HR_COCKPIT"          â”‚ â”‚
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ // 4. Insert into database                                          â”‚ â”‚
â”‚    â”‚ const runData = {                                                   â”‚ â”‚
â”‚    â”‚   id: run.id,                                                       â”‚ â”‚
â”‚    â”‚   code: code,                    // "ABC123"                       â”‚ â”‚
â”‚    â”‚   code_type: code_type,          // "HR_COCKPIT"                   â”‚ â”‚
â”‚    â”‚   pct: 0,                                                        â”‚ â”‚
â”‚    â”‚   status: 'RUNNING',                                             â”‚ â”‚
â”‚    â”‚   // ... other fields                                             â”‚ â”‚
â”‚    â”‚ }                                                                  â”‚ â”‚
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ await supabase.from('runs').insert(runData)                       â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Database Storage (Supabase)                                             â”‚
â”‚                                                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ INSERT INTO runs (id, code, code_type, pct, status, ...)           â”‚ â”‚
â”‚    â”‚ VALUES ('abc123def456', 'ABC123', 'HR_COCKPIT', 0, 'RUNNING', ...) â”‚ â”‚
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ Result: New row in 'runs' table with:                              â”‚ â”‚
â”‚    â”‚ - id: 'abc123def456'                                               â”‚ â”‚
â”‚    â”‚ - code: 'ABC123'                                                   â”‚ â”‚
â”‚    â”‚ - code_type: 'HR_COCKPIT'                                          â”‚ â”‚
â”‚    â”‚ - status: 'RUNNING'                                                â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Progress Updates (app/api/actor-update/route.ts)                        â”‚
â”‚                                                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ // Apify sends progress updates                                    â”‚ â”‚
â”‚    â”‚ POST /api/actor-update                                             â”‚ â”‚
â”‚    â”‚ { runId: 'abc123def456', done: 5, total: 10, status: 'RUNNING' }   â”‚ â”‚
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ // CRITICAL: Preserve existing code values                          â”‚ â”‚
â”‚    â”‚ const currentRun = await supabase.from('runs').select('*').eq('id', runId).single()
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ const runData = {                                                   â”‚ â”‚
â”‚    â”‚   id: runId,                                                        â”‚ â”‚
â”‚    â”‚   pct: 50,                                                          â”‚ â”‚
â”‚    â”‚   status: 'RUNNING',                                                â”‚ â”‚
â”‚    â”‚   code: currentRun.code,           // PRESERVED: "ABC123"          â”‚ â”‚
â”‚    â”‚   code_type: currentRun.code_type, // PRESERVED: "HR_COCKPIT"      â”‚ â”‚
â”‚    â”‚   // ... other updated fields                                      â”‚ â”‚
â”‚    â”‚ }                                                                   â”‚ â”‚
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ await supabase.from('runs').upsert(runData, { onConflict: 'id' })  â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Frontend Display (useRunList.ts + RunList.tsx)                          â”‚
â”‚                                                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚    â”‚ // 1. Fetch data from database                                      â”‚ â”‚
â”‚    â”‚ const { data } = await supabase                                      â”‚ â”‚
â”‚    â”‚   .from('runs')                                                      â”‚ â”‚
â”‚    â”‚   .select('*')  // Includes code, code_type                         â”‚ â”‚
â”‚    â”‚   .order('started_at', { ascending: false })                        â”‚ â”‚
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ // 2. Data received:                                                â”‚ â”‚
â”‚    â”‚ data = [                                                            â”‚ â”‚
â”‚    â”‚   {                                                                 â”‚ â”‚
â”‚    â”‚     id: 'abc123def456',                                            â”‚ â”‚
â”‚    â”‚     code: 'ABC123',                                                â”‚ â”‚
â”‚    â”‚     code_type: 'HR_COCKPIT',                                       â”‚ â”‚
â”‚    â”‚     status: 'RUNNING',                                             â”‚ â”‚
â”‚    â”‚     // ... other fields                                            â”‚ â”‚
â”‚    â”‚   }                                                                â”‚ â”‚
â”‚    â”‚ ]                                                                   â”‚ â”‚
â”‚    â”‚                                                                     â”‚ â”‚
â”‚    â”‚ // 3. Display in table                                              â”‚ â”‚
â”‚    â”‚ <td>{run.code || '-'}</td>         // Shows: "ABC123"              â”‚ â”‚
â”‚    â”‚ <td>{run.code_type || '-'}</td>    // Shows: "HR_COCKPIT"          â”‚ â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” **Debugging Points**

### **Point 1: Frontend Input**
```javascript
// Check if user input is captured
console.log('User entered code:', code);
console.log('User selected codeType:', codeType);
```

### **Point 2: API Request**
```javascript
// Check what's sent to API
console.log('Request body:', JSON.stringify({
  actorId,
  input: { code, codeType }
}));
```

### **Point 3: API Processing**
```javascript
// Check what API receives and processes
console.log('API received input:', input);
console.log('Extracted code:', code);
console.log('Extracted code_type:', code_type);
```

### **Point 4: Database Insert**
```javascript
// Check what's inserted into database
console.log('Data to insert:', runData);
console.log('Insert result:', insertedData);
```

### **Point 5: Database Query**
```javascript
// Check what's retrieved from database
console.log('Database query result:', data);
```

### **Point 6: Frontend Display**
```javascript
// Check what frontend receives
console.log('Frontend received runs:', runs);
```

## ğŸš¨ **Potential Failure Points**

1. **Frontend**: User doesn't enter code value
2. **API Request**: Network error or malformed request
3. **API Processing**: Code extraction fails
4. **Database Insert**: Database error or constraint violation
5. **Progress Updates**: Code values overwritten during updates
6. **Database Query**: Query doesn't include code columns
7. **Frontend Display**: Component doesn't render code values

## ğŸ”§ **Quick Test**

To test the flow, add this temporary code to your ImportForm:

```javascript
// Add to handleSubmit before the fetch call
console.log('ğŸ” DEBUG - About to send:', {
  actorId,
  input: { code, codeType }
});
```

This will show you exactly what data is being sent to the API.

